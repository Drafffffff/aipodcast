# AI播客生成应用（前端）- 产品需求文档 PRD v1.1

本PRD仅面向 Next.js 前端实现，去除了GPU/AI与服务端实现细节；以“与后端的接口契约”为边界，聚焦界面、交互、数据流与状态管理。

## 1. 环境配置（前端）
- 参见根目录 `.env.example`，前端仅需：
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- 本地开发：`.env.local` 覆盖上述变量。
- 禁止在仓库中提交任何私密密钥。

## 2. 目标与范围
- 范围：Next.js 单页应用（App Router）+ Supabase 客户端集成。
- 不在范围：GPU后端、内容抓取、AI生成、服务端实现与运维。
- 目标：
  - 用户可登录/登出
  - 在“生成”页提交网页 URL 创建任务（调用后端API）
  - 在“任务列表”页查看任务状态与结果
  - 在“详情/播放”页查看单任务详情并播放音频

## 3. 角色与权限
- 访客：只能访问登录页、公共介绍页
- 登录用户：可创建任务、查看自己的任务与音频、进行播放/下载（如后端允许）

## 4. 信息架构与页面

### 4.1 顶层导航
- Logo（返回首页）
- 生成
- 任务
- 账号（登录状态：头像/菜单；未登录：登录按钮）

### 4.2 页面清单
1) `/` 首页/介绍
- 简要说明产品价值与流程：输入URL → 系统生成播客 → 回列表查看/播放。
- CTA：前往生成页（未登录则先登录）。

2) `/auth` 登录/注册页
- 支持邮箱+密码登录（最低要求）
- 预留第三方OAuth入口位（按钮可隐藏或置灰）
- 登录成功后跳转回来源页或`/generate`

3) `/generate` 生成页
- 表单：URL 输入框 + 提交按钮
- 校验：必填、URL合法性（http/https）
- 提交行为：
  - 调用后端“创建任务”API
  - 成功后toast提示并跳转 `/tasks` 或留在本页显示快捷入口
  - 失败展示后端返回错误信息
- 说明区：
  - 可解析的网站类型提示
  - 预计生成时长、配额/上限提醒（若后端返回）

4) `/tasks` 任务列表页
- 列表字段：标题/URL、状态、创建时间、更新时间、操作
- 状态徽标：pending / processing / completed / failed
- 交互：
  - 轮询或实时订阅任务变更（Supabase Realtime，可选）
  - 点击行跳转到详情页 `/tasks/[id]`
  - 顶部搜索（按标题/URL）、筛选（按状态）

5) `/tasks/[id]` 任务详情/播放页
- 基本信息：标题、URL、状态、创建/更新/完成时间
- 当 status = completed：
  - 音频播放器：播放/暂停、进度条、音量、倍速
  - 下载按钮（如果后端提供 `file_url` 且允许跨域）
  - 文本稿显示（可折叠）
- 当 status = failed：
  - 显示错误消息 `error_message`
  - 提供“返回列表”与“重新生成”（若后端提供接口）
- 当 status = pending/processing：
  - 显示进度/骨架屏，支持实时更新

## 5. 组件与交互细节
- 表单组件：
  - URL 输入：失焦或提交时校验（正则+URL API）
  - 禁用提交按钮状态：提交中/无效输入
  - 错误提示区域（inline + toast）
- 列表组件：
  - 空状态与加载状态
  - 分页或无限滚动（默认分页）
- 播放器组件：
  - 使用 `HTMLAudioElement` 或 `howler.js`
  - 记忆上次播放进度（localStorage，按任务ID）
- 全局：
  - Toast/通知（成功/失败/处理中）
  - Loading Overlay（可选）

## 6. 与后端接口契约（仅前端视角）

说明：接口路径、鉴权与CORS由后端提供；前端基于 Supabase JS 客户端或HTTP请求访问。

### 6.1 任务数据结构
```ts
// Task
{
  id: string;            // UUID
  user_id: string;       // 当前登录用户ID
  url: string;           // 提交的网页地址
  title?: string;        // 任务标题（可后端生成）
  status: 'pending' | 'processing' | 'completed' | 'failed';
  created_at: string;    // ISO
  updated_at: string;    // ISO
  processed_at?: string; // ISO
  error_message?: string;
}

// File (当任务完成)
{
  id: string;
  task_id: string;
  file_url: string;      // 直链或需签名的可访问地址
  file_size?: number;
  duration?: number;     // 秒
  transcript?: string;   // 可选：文本稿
  created_at: string;
}
```

### 6.2 创建任务
- 方法：POST `/api/tasks`（或使用 Supabase RPC/insert）
- 请求体：`{ url: string }`
- 响应：返回 Task 对象
- 前端行为：成功后toast并跳转列表

### 6.3 获取任务列表
- 方法：GET `/api/tasks?status=...&q=...&page=...`
- 响应：`{ items: Task[], total: number, page: number, pageSize: number }`
- 前端行为：渲染表格，支持筛选与搜索

### 6.4 获取任务详情
- 方法：GET `/api/tasks/:id`
- 响应：`{ task: Task, files?: File[] }`

### 6.5 实时更新（可选）
- 方案：Supabase Realtime 订阅 `podcast_tasks` 表的变更（insert/update）
- 行为：收到变更事件后更新列表/详情状态

### 6.6 音频访问
- 由后端返回 `file_url`（公共或签名URL）
- 前端直接赋予 `<audio src>`；若需鉴权则通过后端代理

## 7. 状态管理与数据流
- 轻量方案：React Query + Supabase 客户端
  - 查询：`useQuery` 拉取列表与详情
  - 变更：`useMutation` 创建任务
  - 实时：可用 Supabase channel 订阅表更新并 `queryClient.invalidateQueries`
- 路由：App Router（`/app` 目录）
- 会话：`@supabase/auth-helpers-nextjs` 或 `createClient` + cookies/session

## 8. 验证与空/错态
- URL 非法：表单下方红字提示 + 禁用提交
- 无权限：跳转 `/auth` 并提示登录
- 列表为空：展示空态组件与“去生成”按钮
- 后端报错：toast + 错误详情（仅必要信息）

## 9. 视觉与可用性
- 设计系统：Tailwind + Radix UI/Shadcn UI
- 暗色模式：系统跟随或手动切换（可选）
- 可访问性：
  - 表单具名label
  - 键盘可操作（Tab序、Space/Enter）
  - 播放器控件aria属性

## 10. 性能与SEO
- 采用 App Router 的 `Server Components` 渲染非个性化内容
- 列表分页/懒加载，减少一次性数据量
- 音频按需加载
- 基础Meta：标题/描述/OG

## 11. 监控与埋点（前端）
- 基础埋点：创建任务、播放、暂停、下载
- 错误上报：`window.onerror` + 选用 Sentry（可选）

## 12. 开发清单（前端）
- 基础设施
  - [ ] Supabase 客户端配置（公共环境变量）
  - [ ] 全局样式、主题与UI库接入
  - [ ] Toast/Loading 组件
- 认证
  - [ ] 登录/注册页，与 Supabase Auth 打通
  - [ ] 会话保护（受保护路由中间件）
- 生成页
  - [ ] URL 表单 + 校验 + 提交
  - [ ] 提交后跳转与提示
- 任务列表
  - [ ] 列表渲染、分页、搜索、筛选
  - [ ] 实时订阅（可选）
- 任务详情/播放
  - [ ] 详情信息展示
  - [ ] 播放器（进度、倍速、音量、记忆进度）
  - [ ] 失败态与错误信息展示

## 13. 交付与部署（前端）
- 构建：`next build`
- 运行：`next start`
- 部署：Vercel（推荐）
- 环境：Vercel 项目设置中配置 `NEXT_PUBLIC_SUPABASE_URL/ANON_KEY`

---
文档版本：v1.1  
最后更新：2025-08-24
# AI播客生成应用 - 产品需求文档 (PRD)

## 环境配置

项目使用Supabase作为后端服务，需要配置以下环境变量。

详细的环境变量配置请参考项目根目录下的 `.env.example` 文件。

主要配置项包括：
- Supabase连接配置（URL、密钥等）
- PostgreSQL数据库连接信息  
- GPU后端服务配置
- AI服务API密钥（OpenAI、ElevenLabs等）

**设置方法**：
1. 复制 `.env.example` 为 `.env.local`
2. 根据实际环境修改对应的配置值
3. 确保所有敏感信息不要提交到版本控制系统

# 项目概述
本项目是一个AI驱动的播客生成应用，用户可以通过输入网页URL，系统自动抓取网页内容并生成相应的播客音频。该项目采用NextJS作为前端框架，Supabase作为后端服务，GPU后端负责AI处理任务。

## 核心功能
- 用户注册登录系统
- 网页内容抓取和解析
- AI播客内容生成
- 任务队列管理
- 播客列表管理和播放

# 系统架构

## 前端（NextJS）
- **用户界面**: 提供用户友好的Web界面
- **用户认证**: 集成Supabase认证系统
- **内容提交**: 用户输入网页URL的界面
- **任务监控**: 实时显示任务处理状态
- **播客管理**: 播客列表展示和播放功能

## 后端（Supabase）
- **用户认证**: 处理用户注册、登录、会话管理
- **数据库管理**: 存储用户信息、任务记录、播客元数据
- **队列服务**: 管理AI处理任务队列
- **API服务**: 提供数据接口和业务逻辑

## AI处理后端（GPU服务器）
- **内容处理**: 从队列获取任务并处理
- **AI生成**: 利用GPU算力生成播客内容
- **结果回写**: 完成后更新数据库状态

# 核心业务流程

## 1. 用户认证流程
```
用户注册/登录 → Supabase用户认证 → 获取访问权限
```

## 2. 播客生成流程
```
用户输入URL → 前端验证 → 创建任务记录 → 加入处理队列 
→ GPU后端获取任务 → 内容抓取 → AI生成播客 → 更新数据库状态
```

## 3. 任务管理流程
```
任务创建 → 队列排队 → 状态更新 → 处理完成 → 结果展示
```

# 功能模块详细设计

## 1. 用户管理模块

### 1.1 用户注册
- **功能描述**: 新用户账号创建
- **实现方式**: 通过Supabase Auth实现
- **支持方式**: 邮箱注册、第三方登录（Google、GitHub等）
- **数据验证**: 邮箱格式验证、密码强度检查

### 1.2 用户登录
- **功能描述**: 已注册用户身份验证
- **会话管理**: JWT token管理
- **安全措施**: 密码加密存储、登录失败限制

### 1.3 用户资料管理
- **个人信息**: 用户名、邮箱、头像
- **使用统计**: 生成播客数量、使用时长等

## 2. 播客生成模块

### 2.1 URL输入界面
- **输入验证**: URL格式检查、网站可访问性验证
- **支持类型**: 支持常见网站类型（新闻、博客、文档等）
- **预处理**: URL标准化、重定向处理

### 2.2 内容抓取
- **技术实现**: 在GPU后端实现网页内容抓取
- **内容解析**: 提取主要文本内容，过滤广告和无关信息
- **格式处理**: 处理各种网页格式（HTML、Markdown等）

### 2.3 AI内容生成
- **语言模型**: 使用大语言模型进行内容理解和转换
- **播客脚本**: 生成适合播客格式的对话脚本
- **语音合成**: 将文本转换为自然语音
- **音频处理**: 音频格式优化、时长控制

## 3. 任务队列模块

### 3.1 任务创建
- **任务信息**: URL、用户ID、创建时间、优先级
- **状态管理**: 待处理、处理中、已完成、失败
- **任务ID**: 唯一标识符生成

### 3.2 队列管理
- **FIFO处理**: 先进先出的任务处理顺序
- **优先级支持**: VIP用户任务优先处理
- **负载均衡**: 多个GPU实例的任务分发

### 3.3 状态同步
- **实时更新**: WebSocket或轮询机制更新任务状态
- **进度反馈**: 处理进度百分比显示
- **错误处理**: 失败任务的重试机制

## 4. 播客管理模块

### 4.1 播客列表
- **列表展示**: 用户生成的所有播客
- **排序筛选**: 按时间、标题、状态排序
- **搜索功能**: 标题和内容搜索

### 4.2 播客播放
- **在线播放**: 网页端音频播放器
- **播放控制**: 播放、暂停、进度控制、速度调节
- **下载功能**: 支持音频文件下载

### 4.3 播客管理
- **重命名**: 自定义播客标题
- **删除**: 删除不需要的播客
- **分享**: 生成分享链接
- **收藏**: 标记重要播客

# 数据库设计

## 用户表 (users)
```sql
- id: UUID (主键)
- email: VARCHAR (唯一)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
- subscription_type: VARCHAR (免费/付费)
```

## 播客任务表 (podcast_tasks)
```sql
- id: UUID (主键)
- user_id: UUID (外键)
- url: TEXT
- title: VARCHAR
- status: VARCHAR (pending/processing/completed/failed)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
- processed_at: TIMESTAMP
- error_message: TEXT
```

## 播客文件表 (podcast_files)
```sql
- id: UUID (主键)
- task_id: UUID (外键)
- file_url: TEXT
- file_size: BIGINT
- duration: INTEGER (秒)
- transcript: TEXT
- created_at: TIMESTAMP
```

# 技术栈

## 前端技术
- **框架**: Next.js 14+ (React 18+)
- **样式**: Tailwind CSS
- **状态管理**: React Hooks / Zustand
- **音频播放**: React Player 或 Howler.js
- **UI组件**: Radix UI / Shadcn UI

## 后端技术
- **BaaS**: Supabase (数据库 + 认证 + 实时功能)
- **数据库**: PostgreSQL
- **文件存储**: Supabase Storage
- **API**: Supabase Auto-generated APIs

## AI后端技术
- **语言**: Python
- **框架**: FastAPI / Flask
- **AI模型**: OpenAI GPT / 开源LLM
- **语音合成**: ElevenLabs / Azure Speech
- **任务队列**: Redis / PostgreSQL

# 项目子系统

根据系统流程图，项目包含三个主要子系统：

## 1. NextJS前端系统
负责用户界面和用户交互的所有功能：

### 主要功能模块：
- **用户登陆**: 集成Supabase认证，支持邮箱登录和第三方登录
- **进入生成界面**: 用户成功登录后的主界面，展示生成播客的操作区域
- **用户输入网页URL**: 提供URL输入框，支持URL验证和预处理
- **在数据库初始化任务信息**: 创建新的播客生成任务记录
- **发送queue任务**: 将任务添加到处理队列中
- **用户进入任务列表页面**: 展示用户所有播客任务的状态和历史
- **读取数据库信息**: 获取任务状态、播客信息等数据
- **加载列表页面**: 动态渲染任务列表和播客管理界面

### 技术实现：
- 使用Next.js App Router进行页面路由
- 集成Supabase客户端进行数据操作
- 使用React Hooks管理组件状态
- 实现响应式设计，支持移动端访问

## 2. Supabase后端系统
作为主要的后端服务，处理数据存储和业务逻辑：

### 主要功能模块：
- **Supabase用户认证**: 
  - 用户注册、登录、会话管理
  - JWT token生成和验证
  - 第三方OAuth集成（Google、GitHub等）

- **数据库添加新条目**: 
  - 创建新的播客任务记录
  - 存储URL、用户信息、任务状态
  - 生成唯一任务ID

- **接收queue任务**: 
  - 任务队列管理
  - 任务状态更新机制
  - 与GPU后端的通信接口

- **数据库更新**: 
  - 实时更新任务处理状态
  - 存储生成的播客文件信息
  - 错误日志记录

- **返回数据库信息**: 
  - 提供REST API接口
  - 实时数据订阅功能
  - 数据查询和筛选

### 数据库表结构：
- **users**: 用户基本信息
- **podcast_tasks**: 播客生成任务
- **podcast_files**: 播客文件元数据
- **task_queue**: 任务队列状态

## 3. GPU后端系统
专门负责AI内容生成和计算密集型任务：

### 主要功能模块：
- **读取queue任务**: 
  - 从Supabase获取待处理任务
  - 实现任务轮询或推送机制
  - 任务优先级管理

- **完成任务完善数据库**: 
  - 网页内容抓取和解析
  - AI播客内容生成
  - 语音合成和音频处理
  - 结果文件上传到Supabase Storage
  - 更新任务状态为已完成

### 技术实现：
- **内容抓取**: 使用Selenium/Playwright进行网页抓取
- **内容解析**: BeautifulSoup/readability进行内容提取
- **AI生成**: 
  - 大语言模型进行内容理解和脚本生成
  - 支持OpenAI GPT或开源模型（LLaMA、ChatGLM等）
- **语音合成**: 
  - ElevenLabs API或Azure Speech Services
  - 支持多种语音和语言
- **音频处理**: FFmpeg进行音频格式转换和优化

# 系统交互流程

## 核心业务流程详解：

### 1. 用户认证流程
```
用户访问网站 → 点击登录 → Supabase认证 → 获取用户信息 → 重定向到主界面
```

### 2. 播客生成完整流程
```
1. 用户登录成功 → 进入生成界面
2. 用户输入网页URL → 前端验证URL格式
3. 初始化任务信息 → 在Supabase中创建任务记录
4. 发送queue任务 → 任务加入处理队列
5. GPU后端读取任务 → 开始处理网页内容
6. 内容抓取和AI生成 → 生成播客音频
7. 完成任务 → 更新数据库状态和文件信息
8. 用户查看结果 → 在任务列表页面播放或下载
```

### 3. 任务状态管理
- **pending**: 任务已创建，等待处理
- **processing**: GPU后端正在处理
- **completed**: 生成完成，可以播放
- **failed**: 处理失败，显示错误信息

# 部署架构

## 生产环境部署
- **前端**: Vercel自动部署（集成GitHub）
- **后端**: Supabase云服务
- **GPU后端**: 
  - 云GPU实例（AWS/GCP/Azure）
  - 或本地GPU服务器
  - Docker容器化部署

## 开发环境
- **前端**: 本地Next.js开发服务器
- **后端**: Supabase本地开发环境
- **GPU后端**: 本地Python开发环境

# 性能和扩展性考虑

## 性能优化
- **前端**: Next.js SSR/SSG优化、图片懒加载、代码分割
- **后端**: 数据库索引优化、连接池管理
- **GPU后端**: 模型缓存、批处理优化

## 扩展性设计
- **水平扩展**: GPU后端支持多实例部署
- **负载均衡**: 任务队列的智能分发
- **缓存策略**: Redis缓存热门数据

# 安全性设计

## 数据安全
- **用户认证**: JWT token + 会话管理
- **API安全**: Row Level Security (RLS)
- **文件存储**: Supabase Storage安全策略

## 隐私保护
- **数据加密**: 敏感数据加密存储
- **访问控制**: 用户只能访问自己的数据
- **数据清理**: 定期清理过期任务和文件

# 开发计划

## 第一阶段：基础功能开发（2-3周）
- [ ] 项目初始化和环境配置
- [ ] Supabase后端配置和数据库设计
- [ ] 用户认证系统集成
- [ ] 基础UI界面开发（登录、主页、任务列表）
- [ ] URL输入和验证功能

## 第二阶段：核心功能开发（3-4周）
- [ ] GPU后端服务开发
- [ ] 网页内容抓取功能
- [ ] 任务队列系统实现
- [ ] AI内容生成集成（使用OpenAI API）
- [ ] 语音合成集成
- [ ] 文件存储和管理

## 第三阶段：功能完善和优化（2-3周）
- [ ] 播客播放器开发
- [ ] 任务状态实时更新
- [ ] 错误处理和重试机制
- [ ] 性能优化和缓存
- [ ] 移动端适配

## 第四阶段：测试和部署（1-2周）
- [ ] 单元测试和集成测试
- [ ] 用户体验测试
- [ ] 性能测试和优化
- [ ] 生产环境部署
- [ ] 监控和日志系统

# 风险评估和缓解策略

## 技术风险
- **AI服务依赖**: 准备多个AI服务提供商作为备选
- **GPU资源**: 考虑使用云GPU服务确保稳定性
- **网页抓取限制**: 实现智能重试和代理机制

## 业务风险
- **版权问题**: 明确用户协议，仅供个人学习使用
- **服务成本**: 实现用量监控和费用控制机制
- **用户体验**: 提供详细的进度反馈和错误信息

## 运营风险
- **服务稳定性**: 实现健康检查和自动恢复机制
- **数据安全**: 定期备份和安全审计
- **扩展性**: 设计可水平扩展的架构

# 成功指标

## 技术指标
- 系统可用性 > 99%
- 平均播客生成时间 < 5分钟
- 支持并发用户数 > 100
- 错误率 < 1%

## 业务指标
- 用户注册转化率
- 播客生成成功率
- 用户活跃度和留存率
- 用户满意度评分

# 后续功能规划

## 短期计划（3-6个月）
- 支持更多语言和声音选择
- 批量URL处理功能
- 播客内容定制选项
- 社交分享功能

## 长期计划（6-12个月）
- 移动App开发
- 企业版功能
- API接口开放
- AI模型优化和定制化

---

**文档版本**: v1.0  
**创建日期**: 2025年8月24日  
**最后更新**: 2025年8月24日